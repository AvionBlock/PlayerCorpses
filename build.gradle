/*
 * This file was generated by the Gradle 'init' task.
 *
 * This is a general purpose Gradle build.
 * Learn more about Gradle by exploring our Samples at https://docs.gradle.org/8.13/samples
 * This project uses @Incubating APIs which are subject to change.
 */

plugins {
  id 'java'
  id 'com.gradleup.shadow' version '9.0.0-beta10'
}

group = 'io.greitan'
version = project.hasProperty('VERSION') ? project.VERSION : 'UNKNOWN'

repositories {
    mavenCentral() 
    maven {
        name = "jitpack"
        url = "https://jitpack.io"
    }
    maven {
        name = "PaperMC"
        url = "https://repo.papermc.io/repository/maven-public/"
    }
    maven {
        name = "FancyNpcs"
        url = "https://repo.fancyplugins.de/releases"
    }
}

dependencies {
    // Paper API
    compileOnly 'io.papermc.paper:paper-api:1.21.4-R0.1-SNAPSHOT'
    // FancyNpcs
    compileOnly "de.oliver:FancyNpcs:2.4.4"
    // FoliaLib
    implementation 'com.github.TechnicallyCoded:FoliaLib:0.4.4'

    // Lombok
    compileOnly 'org.projectlombok:lombok:1.18.36'
    annotationProcessor 'org.projectlombok:lombok:1.18.36'
}

tasks.withType(JavaCompile) {
    // Set encoding for Java files
    options.encoding = 'UTF-8'
}

java {
    // Java 21
    sourceCompatibility = JavaVersion.VERSION_21
    targetCompatibility = JavaVersion.VERSION_21
}

shadowJar {
    archiveClassifier.set('all')
    // Relocate package to avoid conflicts
    relocate "com.tcoded.folialib", "io.greitan.avion.lib.folialib"
    duplicatesStrategy = DuplicatesStrategy.EXCLUDE
}

// Custom task to copy the shadow JAR to a test server
task copyToTestServer(type: Copy) {
    from shadowJar  // Get the shadow JAR
    into "C:\\JavaTest\\plugins"  // Define the target directory for the JAR
}

// Ensure shadowJar task is executed after build
build.finalizedBy shadowJar

// If the project has the 'DEV' property, also run the copyToTestServer
if(project.hasProperty('DEV')) build.finalizedBy copyToTestServer

// Why u read comments bro?
